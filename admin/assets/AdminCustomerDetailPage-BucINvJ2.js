import{a as I,r,u as $,j as e}from"./index-Dya0Yoma.js";import{A as b,f as w,a as l,g as J,b as Q}from"./AdminLayout-B_zPqndL.js";import{e as U,g as q,h as G,i as H,j as K,k as M,c as V,A as W,r as X,m as Y,n as Z}from"./api-BmpbTcpP.js";import{B as ee}from"./Button-DC7R08JE.js";function re(){const{id:n}=I(),[a,y]=r.useState(null),[h,S]=r.useState([]),[p,_]=r.useState([]),[d,o]=r.useState([]),[u,j]=r.useState([]),[z,C]=r.useState([]),[c,k]=r.useState("overview"),[A,N]=r.useState(!0),[x,f]=r.useState(""),[m,g]=r.useState(""),v=$();r.useEffect(()=>{n&&T(parseInt(n))},[n]);const T=async t=>{N(!0);const s=localStorage.getItem("admin_token");if(!s){v("/login");return}try{const[i,D,F,P,E,B]=await Promise.all([U(s,t),q(s,t),G(s,t),H(s,t),K(s,t),M(s,t)]);y(i),S(D.items.map(V)),_(F.items),o(P),j(E),C(B)}catch(i){console.error("Failed to load customer data:",i),i instanceof W&&i.status===401&&(localStorage.removeItem("admin_token"),v("/login"))}finally{N(!1)}},R=async t=>{if(t.preventDefault(),!a||!x.trim())return;const s=localStorage.getItem("admin_token");if(s)try{const i=await Y(s,a.id,x.trim());o([...d,i]),f("")}catch{alert("Failed to add tag")}},L=async t=>{if(!a)return;const s=localStorage.getItem("admin_token");if(s)try{await X(s,a.id,t),o(d.filter(i=>i.tag!==t))}catch{alert("Failed to remove tag")}},O=async t=>{if(t.preventDefault(),!a||!m.trim())return;const s=localStorage.getItem("admin_token");if(s)try{const i=await Z(s,a.id,m.trim());j([i,...u]),g("")}catch{alert("Failed to add note")}};return A||!a?e.jsx(b,{title:"Loading...",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-32 bg-[#1e1e26] rounded-xl"}),e.jsx("div",{className:"h-64 bg-[#1e1e26] rounded-xl"})]})}):e.jsxs(b,{children:[e.jsx("div",{className:"bg-[#1e1e26] p-6 rounded-xl border border-white/5 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:a.full_name||"No Name"}),e.jsxs("div",{className:"flex items-center gap-2 text-zinc-400 text-sm",children:[e.jsx("span",{children:a.email}),a.tags.length>0&&e.jsx("span",{className:"text-zinc-600",children:"•"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded text-xs",children:[t.tag,e.jsx("button",{onClick:()=>L(t.tag),className:"hover:text-white",children:"×"})]},t.id))})]}),e.jsx("form",{onSubmit:R,className:"mt-3 flex gap-2",children:e.jsx("input",{value:x,onChange:t=>f(t.target.value),placeholder:"+ Add tag",className:"bg-[#14141a] text-xs text-white rounded px-2 py-1 border border-white/10 w-32"})})]}),e.jsxs("div",{className:"flex gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500 text-xs uppercase",children:"Total Spend"}),e.jsx("p",{className:"text-emerald-400 font-bold text-lg",children:w(a.total_spend)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500 text-xs uppercase",children:"Orders"}),e.jsx("p",{className:"text-white font-bold text-lg",children:a.total_orders})]})]})]})}),e.jsx("div",{className:"flex border-b border-white/5 mb-6 overflow-x-auto",children:["overview","orders","tickets","notes","activity"].map(t=>e.jsx("button",{onClick:()=>k(t),className:`px-6 py-3 text-sm font-medium whitespace-nowrap capitalize transition-colors ${c===t?"text-emerald-400 border-b-2 border-emerald-400":"text-zinc-400 hover:text-white"}`,children:t},t))}),e.jsxs("div",{className:"space-y-6",children:[c==="overview"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"bg-[#1e1e26] p-6 rounded-xl border border-white/5",children:[e.jsx("h3",{className:"font-bold text-white mb-4",children:"Quick Stats"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-400",children:"First Seen"}),e.jsx("dd",{className:"text-white",children:l(a.last_activity||"")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-400",children:"Last Activity"}),e.jsx("dd",{className:"text-white",children:a.last_activity?l(a.last_activity):"-"})]})]})]})}),c==="orders"&&e.jsxs("div",{className:"space-y-4",children:[h.map(t=>e.jsxs("div",{className:"bg-[#1e1e26] p-4 rounded-xl border border-white/5 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:t.productTitle}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] ${Q(t.status)}`,children:J(t.status)})]}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[t.id," • ",l(t.createdAt)]})]}),e.jsx("p",{className:"text-emerald-400 font-bold text-sm",children:w(t.productPrice)})]},t.id)),h.length===0&&e.jsx("p",{className:"text-zinc-500 text-center py-8",children:"No orders."})]}),c==="tickets"&&e.jsxs("div",{className:"space-y-4",children:[p.map(t=>e.jsxs("div",{className:"bg-[#1e1e26] p-4 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h4",{className:"text-white font-medium",children:t.title}),e.jsx("span",{className:"text-xs bg-white/10 px-2 py-1 rounded",children:t.status})]}),e.jsx("p",{className:"text-zinc-400 text-sm mt-1",children:t.message}),e.jsx("p",{className:"text-zinc-600 text-xs mt-2",children:l(t.created_at)})]},t.id)),p.length===0&&e.jsx("p",{className:"text-zinc-500 text-center py-8",children:"No tickets."})]}),c==="notes"&&e.jsxs("div",{children:[e.jsxs("form",{onSubmit:O,className:"mb-6",children:[e.jsx("textarea",{value:m,onChange:t=>g(t.target.value),placeholder:"Add internal note...",className:"w-full bg-[#14141a] text-white rounded-lg border border-white/10 p-3 text-sm focus:ring-emerald-500",rows:3}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(ee,{size:"sm",type:"submit",children:"Add Note"})})]}),e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsxs("div",{className:"bg-[#1e1e26] p-4 rounded-xl border border-white/5",children:[e.jsx("p",{className:"text-zinc-300 text-sm whitespace-pre-wrap",children:t.note}),e.jsxs("p",{className:"text-zinc-600 text-xs mt-2",children:[t.created_by_admin," • ",l(t.created_at)]})]},t.id))})]}),c==="activity"&&e.jsx("div",{className:"space-y-4",children:z.map(t=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full mt-2 shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-white text-sm font-medium",children:[t.type.replace("_"," ").toUpperCase(),t.reference_id&&e.jsxs("span",{className:"text-zinc-500 ml-1",children:["#",t.reference_id]})]}),e.jsx("p",{className:"text-zinc-500 text-xs",children:l(t.created_at)}),t.metadata_json&&e.jsx("pre",{className:"text-xs text-zinc-600 mt-1 font-mono",children:JSON.stringify(t.metadata_json,null,2)})]})]},t.id))})]})]})}export{re as AdminCustomerDetailPage};
